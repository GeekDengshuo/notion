### **向量的表示方式**

```cpp
vector<float, 4> vec1; // 向量vec1包含4个float元素

float4
vec1; //向量vec1包含4个float元素
```

如果只是用vector默认表示包含4个float元素的类型

向量元素的获取

向量中的1-4个元素的获取

可以使用 X Y Z W 来表示，也可以使用  R G B A 来表示
也可以使用下标的方式  0  1 2  3

另外一种方式 swizzles

分量的名称可以重复出现并进行排布

### **矩阵 matrix**

Matrix 默认表示包含4个vector向量的类型，即16个float类型的变量

Float4x4

```cpp
matrix M

float f0 = M._m00; // 第一行第一列元素(索引从0开始)

float f1 = M._12; // 第一行第二列元素(索引从1开始)

float f2 = M[0][1]; // 第一行第二列元素(索引从0开始)

float2 f3 = M._11_12; // Swizzles
```

矩阵的值获取方式

数学库中创建的矩阵都是行矩阵，但是矩阵从C++传递到HLSL，HLSL默认是列矩阵

矩阵的传递过程发生了一次转置

如果不希望转置，可以添加修饰关键字 row_major

row_major matrix

### **变量修饰符**

| 关键字  | 含义                                                                                                                                                 |
| ------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- |
| static  | 该着色器变量将不会暴露给C++应用层，需要在HLSL中自己初始化，否则使用默认初始化                                                                        |
| extern  | 与static相反，该着色器变量将会暴露给C++应用层                                                                                                        |
| uniform | 该着色器变量允许在C++应用层被改变，但在着色器执行的过程中，其值始终保持不变（运行前可变，运行时不变）。着色器程序中的全局变量默认为既uniform又extern |
| const   | 和C++中的含义相同，它是一个常量，需要被初始化且不可以被修改                                                                                          |

### **控制流**

HLSL 支持  discard关键字用于像素着色阶段抛弃该像素

函数

1.函数只能值传递

2.不支持递归

3.只有内联函数inline

内置函数

| 函数名      | 描述                                                                                                      | 最小支持着色器模型 |
| ----------- | --------------------------------------------------------------------------------------------------------- | ------------------ |
| abs         | 每个分量求绝对值                                                                                          | 1.1                |
| acos        | 求x分量的反余弦值                                                                                         | 1.1                |
| all         | 测试x分量是否按位全为1                                                                                    | 1.1                |
| any         | 测试x分量是否按位存在1                                                                                    | 1.1                |
| asdouble    | 将值按位重新解释成double类型                                                                              | 5.0                |
| asfloat     | 将值按位重新解释成float类型                                                                               | 4.0                |
| asin        | 求x分量的反正弦值                                                                                         | 1.1                |
| asint       | 将值按位重新解释成int类型                                                                                 | 4.0                |
| asuint      | 将值按位重新解释成uint类型                                                                                | 4.0                |
| atan        | 求x分量的反正切值值                                                                                       | 1.1                |
| atan2       | 求(x,y)分量的反正切值                                                                                     | 1.1                |
| ceil        | 求不小于x分量的最小整数                                                                                   | 1.1                |
| clamp       | 将x分量的值限定在[min, max]                                                                               | 1.1                |
| clip        | 丢弃当前像素，如果x分量的值小于0                                                                          | 1.1                |
| cos         | 求x分量的余弦值                                                                                           | 1.1                |
| cosh        | 求x分量的双曲余弦值                                                                                       | 1.1                |
| countbits   | 计算输入整数的位1个数(对每个分量)                                                                         | 5.0                |
| cross       | 计算两个3D向量的叉乘                                                                                      | 1.1                |
| ddx         | 估算屏幕空间中的偏导数∂p/∂x∂p/∂x。这使我们可以确定在屏幕空间的x轴方向上，相邻像素间某属性值pp的变化量 | 2.1                |
| ddy         | 估算屏幕空间中的偏导数∂p/∂y∂p/∂y。这使我们可以确定在屏幕空间的y轴方向上，相邻像素间某属性值pp的变化量 | 2.1                |
| degrees     | 将x分量从弧度转换为角度制                                                                                 | 1.1                |
| determinant | 返回方阵的行列式                                                                                          | 1.1                |
| distance    | 返回两个点的距离值                                                                                        | 1.1                |
| dot         | 返回两个向量的点乘                                                                                        | 1.1                |
| dst         | 计算距离向量                                                                                              | 5.0                |
| exp         | 计算e^x                                                                                                   | 1.1                |
| exp2        | 计算2^x                                                                                                   | 1.1                |
| floor       | 求不大于x分量的最大整数                                                                                   | 1.1                |
| fmod        | 求x/y的余数                                                                                               | 1.1                |
| frac        | 返回x分量的小数部分                                                                                       | 1.1                |
| isfinite    | 返回x分量是否为有限的布尔值                                                                               | 1.1                |
| isinf       | 返回x分量是否为无穷大的布尔值                                                                             | 1.1                |
| isnan       | 返回x分量是否为nan的布尔值                                                                                | 1.1                |
| length      | 计算向量的长度                                                                                            | 1.1                |
| lerp        | 求x + s(y - x)                                                                                            | 1.1                |
| lit         | 返回一个光照系数向量(环境光亮度, 漫反射光亮度, 镜面光亮度, 1.0f)                                          | 1.1                |
| log         | 返回以e为底，x分量的对数                                                                                  | 1.1                |
| log10       | 返回以10为底，x分量的对数                                                                                 | 1.1                |
| log2        | 返回以2为底，x分量的自然对数                                                                              | 1.1                |
| mad         | 返回mvalue * avalue + bvalue                                                                              | 1.1                |
| max         | 返回x分量和y分量的最大值                                                                                  | 1.1                |
| min         | 返回x分量和y分量的最小值                                                                                  | 1.1                |
| modf        | 将值x分开成整数部分和小数部分                                                                             | 1.1                |
| mul         | 矩阵乘法运算                                                                                              | 1                  |
| normalize   | 计算规格化的向量                                                                                          | 1.1                |
| pow         | 返回x^y                                                                                                   | 1.1                |
| radians     | 将x分量从角度值转换成弧度值                                                                               | 1                  |
| rcp         | 对每个分量求倒数                                                                                          | 5                  |
| reflect     | 返回反射向量                                                                                              | 1                  |
| refract     | 返回折射向量                                                                                              | 1.1                |
| reversebits | 对每个分量进行位的倒置                                                                                    | 5                  |
| round       | x分量进行四舍五入                                                                                         | 1.1                |
| rsqrt       | 返回1/sqrt(x)                                                                                             | 1.1                |
| saturate    | 对x分量限制在[0,1]范围                                                                                    | 1                  |
| sign        | 计算符号函数的值，x大于0为1，x小于0为-1，x等于0则为0                                                      | 1.1                |
| sin         | 计算x的正弦                                                                                               | 1.1                |
| sincos      | 返回x的正弦和余弦                                                                                         | 1.1                |
| sinh        | 返回x的双曲正弦                                                                                           | 1.1                |
| smoothstep  | 给定范围[min, max]，映射到值[0, 1]。小于min的值取0，大于max的值取1                                        | 1.1                |
| step        | 返回(x >= a) ? 1 : 0                                                                                      | 1.1                |
| tan         | 返回x的正切值                                                                                             | 1.1                |
| tanh        | 返回x的双曲正切值                                                                                         | 1.1                |
| transpose   | 返回矩阵m的转置                                                                                           | 1                  |
| trunc       | 去掉x的小数部分并返回                                                                                     | 1                  |

### 语义

语义通常是附加在着色器输入/输出参数上的字符串。它在着色器程序的用途如下：

* 用于描述传递给着色器程序的变量参数的含义
* 允许着色器程序接受由渲染管线生成的特殊系统值
* 允许着色器程序传递由渲染管线解释的特殊系统值

系统值语义

SV_

### **Linkage**

为什么要使用linkage ？

动态链接通过接口与虚拟函数分离着色程序的代码块，提升着色的性能

着色器的动态链接，可以让开发人员方便的管理着色程序序列

共享成员变量：

HLSL提供了一种类链接对象(class linkage)

实例化的过程其实就是分配类成员空间的过程，应用程序中的类空间分配计算机主存

* HLSL中定义的渲染类则只能在显示存储器中进行实例化分配，要么声明为常量缓冲区的变量，或者在运行中通过CLassLinkage::CreateClassInstance方法在显存中动态分配
